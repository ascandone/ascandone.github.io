{"componentChunkName":"component---src-components-blog-layout-tsx","path":"/blog/disable-theme-transitions","result":{"pageContext":{"frontmatter":{"date":"Mar 19, 2020","tags":null,"title":"Disable transitions on theme toggle"},"html":"<p>It's difficult to transition between themes smoothly. Adding a CSS <code class=\"language-text\">transition</code> to every element negatively impacts rendering performance, and it also won't work for images, icons, and CSS properties that don't support transitions.</p>\n<p>Instead, we can temporarily remove transitions from all elements so that toggling themes feels snappy and consistent. We'll manually create a stylesheet that disables transitions:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> css <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">'style'</span><span class=\"token punctuation\">)</span>\ncss<span class=\"token punctuation\">.</span>type <span class=\"token operator\">=</span> <span class=\"token string\">'text/css'</span>\ncss<span class=\"token punctuation\">.</span><span class=\"token function\">appendChild</span><span class=\"token punctuation\">(</span>\n  document<span class=\"token punctuation\">.</span><span class=\"token function\">createTextNode</span><span class=\"token punctuation\">(</span>\n    <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">* {\n       -webkit-transition: none !important;\n       -moz-transition: none !important;\n       -o-transition: none !important;\n       -ms-transition: none !important;\n       transition: none !important;\n    }</span><span class=\"token template-punctuation string\">`</span></span>\n  <span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">)</span>\ndocument<span class=\"token punctuation\">.</span>head<span class=\"token punctuation\">.</span><span class=\"token function\">appendChild</span><span class=\"token punctuation\">(</span>css<span class=\"token punctuation\">)</span></code></pre></div>\n<p>Note that we need to manually specify browser prefixes, as this CSS isn't run through any preprocessing.</p>\n<p>After changing the theme (usually this involves toggling a class on <code class=\"language-text\">&lt;body&gt;</code>), we force a browser repaint and remove the stylesheet:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// Toggle the theme here...</span>\n\n<span class=\"token comment\">// Calling getComputedStyle forces the browser to redraw</span>\n<span class=\"token keyword\">const</span> _ <span class=\"token operator\">=</span> window<span class=\"token punctuation\">.</span><span class=\"token function\">getComputedStyle</span><span class=\"token punctuation\">(</span>css<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>opacity\ndocument<span class=\"token punctuation\">.</span>head<span class=\"token punctuation\">.</span><span class=\"token function\">removeChild</span><span class=\"token punctuation\">(</span>css<span class=\"token punctuation\">)</span></code></pre></div>\n<p>Calling <code class=\"language-text\">requestAnimationFrame</code> before removing the stylesheet seemed to work at first, but it was unreliable and elements still transitioned. Using <code class=\"language-text\">getComputedStyle</code> works reliably on every major browser, because it forcibly <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/Window/getComputedStyle\">applies all active stylesheets</a>.</p>\n<p>Before:</p>\n<p><img src=\"/blog/disable-theme-transitions/before.gif\" alt=\"Toggling between light and dark theme, with elements flashing\"></p>\n<p>After (or press <kbd>t</kbd> to try it yourself):</p>\n<p><img src=\"/blog/disable-theme-transitions/after.gif\" alt=\"Toggling between light and dark theme, with no elements flashing\"></p>\n<hr>\n<p>Thanks to <a href=\"https://twitter.com/rauchg\">Guillermo</a> for the idea!</p>"}},"staticQueryHashes":[]}